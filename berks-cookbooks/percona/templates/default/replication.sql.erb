-- Generated by Chef for <%= node["hostname"] %>.
-- Local modifications will be overwritten.

GRANT REPLICATION SLAVE ON *.* TO '<%=node["percona"]["server"]["replication"]["username"]%>'@'%'
      IDENTIFIED BY '<%= @replication_password %>' <% if node["percona"]["server"]["replication"]["ssl_enabled"] %>REQUIRE SSL<% end %>;
FLUSH PRIVILEGES;

<% unless node["percona"]["server"]["replication"]["host"].empty? %>
CHANGE MASTER TO
  MASTER_HOST='<%= node["percona"]["server"]["replication"]["host"] %>',
  MASTER_PORT=<%= node["percona"]["server"]["replication"]["port"] %>,
  MASTER_USER='<%= node["percona"]["server"]["replication"]["username"] %>',
  <% if node["percona"]["server"]["replication"]["ssl_enabled"] %>
  MASTER_SSL=1,
  MASTER_SSL_CA='/etc/mysql/ssl/cacert.pem',
  MASTER_SSL_CERT='/etc/mysql/ssl/client-cert.pem',
  MASTER_SSL_KEY='/etc/mysql/ssl/client-key.pem',
  <% end %>
  MASTER_PASSWORD='<%= @replication_password %>';
START SLAVE;
<% end %>
